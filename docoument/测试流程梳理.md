
## 普适链用例流程梳理

目的熟悉项目，跟踪开发进度


#### 初始化数据:
刚开始没有数据，初始化数据信息
1. 初始化 httpclient 和 websocket 服务器间通信
2. 使用 http api心跳接口上传信息,存在更新，不存在插入; 
   1. 要更新心跳最近更新时间，根据指定时间间隔判断节点是否在线的标志，在后续执行交易命令下发时，排除不在线的节点;  
   2. 成功下发同时要清空要执行的命令
   3. 下发时要判断命令执行过期的时间，超过指定的时候段，命令过期，该命令不予执行
3. api 上传区块信息，同时更新到临时表和历史记录表中
   1. 临时表只存放近期区块数据，每次有客服端连接直接从实时表中查询数据
   2. 历史表存储所有的区块数据
   

4. 上传节点带宽数据信息，存在更新，不存在插入

tips：前端可以写个定时任务模拟节点上传信息； 多个客服端同时发送测试命令，如何执行？
心跳上报时间，这个是什么时间？ 


#### 客服端连接服务端
客户端端与服务端初次连接时`
1.  从整体tps表中，根据日期分组推送到前端
2.  从总体带宽表中，查询带宽信息推送到前端
3.  根据节点信息，分组分类查询，返回区块链的信息 -信标-中继-分片
4.  默认返回信标链的tps情况

tips: tps整体表的信息，带宽总体表，数据从哪儿来？ 每发送一次测试命令，把数据更新整体表中? 定时统计更新，还是实时查询


#### 自动订阅
当前端与服务端初始化之后，当后端有新的数据更新时，通过websocket向前端推送数据
1. 触发条件是间隔区块时间，向前端推送?
2. 当有区块更新时向前端推送?


#### 交互情况
前端发送tps测试命令
1. 通过websocket 想服务端发送测试命令，
2. 后台根据测试 tps交易数量的大小， 查找出在线的节点数量，计算每个节点需要执行的交易数量
   1. 此过程中，需要判断节点是否在线，命令是否过期

3. 命令下发成功，节点清楚命令信息，更新心跳时间





















